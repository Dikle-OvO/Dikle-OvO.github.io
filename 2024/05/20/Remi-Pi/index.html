<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>记录|瑞米派嵌入式Linux开发 | DIKLE | 记录</title><meta name="author" content="黄俊刚"><meta name="copyright" content="黄俊刚"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="前言&amp;emsp;&amp;emsp;由于比赛需要，需使用瑞米派进行Linux嵌入式软件开发。&amp;emsp;&amp;emsp;性能方面：RZ&#x2F;G2L处理器配备Cortex-A55 1.2GHz CPU、Cortex-M33@200MHz MCU、Arm Mali-G31 的3D 图形加速引擎以及支持视频编解码器。&amp;emsp;&amp;emsp;软件方面也十分丰富，官方镜像myir-image-full包含常用系统和调试工具">
<meta property="og:type" content="article">
<meta property="og:title" content="记录|瑞米派嵌入式Linux开发">
<meta property="og:url" content="https://dikle-ovo.github.io/2024/05/20/Remi-Pi/index.html">
<meta property="og:site_name" content="DIKLE | 记录">
<meta property="og:description" content="前言&amp;emsp;&amp;emsp;由于比赛需要，需使用瑞米派进行Linux嵌入式软件开发。&amp;emsp;&amp;emsp;性能方面：RZ&#x2F;G2L处理器配备Cortex-A55 1.2GHz CPU、Cortex-M33@200MHz MCU、Arm Mali-G31 的3D 图形加速引擎以及支持视频编解码器。&amp;emsp;&amp;emsp;软件方面也十分丰富，官方镜像myir-image-full包含常用系统和调试工具">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://dikle-ovo.github.io/my_img/cat.jpg">
<meta property="article:published_time" content="2024-05-20T04:14:24.000Z">
<meta property="article:modified_time" content="2025-06-15T09:08:02.041Z">
<meta property="article:author" content="黄俊刚">
<meta property="article:tag" content="记录">
<meta property="article:tag" content="Linux">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://dikle-ovo.github.io/my_img/cat.jpg"><link rel="shortcut icon" href="/my_img/cat.jpg"><link rel="canonical" href="https://dikle-ovo.github.io/2024/05/20/Remi-Pi/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":false,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '记录|瑞米派嵌入式Linux开发',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-06-15 17:08:02'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="//at.alicdn.com/t/c/font_4475051_etb5xjltcej.css"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.loli.net/css2?family=Noto+Serif+SC:wght@400;500;700&display=swap" rel="stylesheet"><link href="https://fonts.loli.net/css2?family=Ma+Shan+Zheng:wght@400;500;700&display=swap" rel="stylesheet"><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/my_img/cat.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">24</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">13</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/photos/"><i class="fa-fw fab fa-instagram"></i><span> 摄影</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 生活</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://www.bilibili.com"><i class="fa-fw fab fa-bilibili"></i><span> B站</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://www.douban.com/people/Dikle/"><i class="fa-fw iconfont icon-douban"></i><span> 豆瓣</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/my_img/Top_banner.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="DIKLE | 记录"><img class="site-icon" src="/my_img/cat.jpg"/><span class="site-name">DIKLE | 记录</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/photos/"><i class="fa-fw fab fa-instagram"></i><span> 摄影</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 生活</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://www.bilibili.com"><i class="fa-fw fab fa-bilibili"></i><span> B站</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://www.douban.com/people/Dikle/"><i class="fa-fw iconfont icon-douban"></i><span> 豆瓣</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">记录|瑞米派嵌入式Linux开发</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-05-20T04:14:24.000Z" title="发表于 2024-05-20 12:14:24">2024-05-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-06-15T09:08:02.041Z" title="更新于 2025-06-15 17:08:02">2025-06-15</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>29分钟</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>&emsp;&emsp;由于比赛需要，需使用瑞米派进行Linux嵌入式软件开发。<br>&emsp;&emsp;性能方面：RZ/G2L处理器配备Cortex-A55 1.2GHz CPU、Cortex-M33@200MHz MCU、Arm Mali-G31 的3D 图形加速引擎以及支持视频编解码器。<br>&emsp;&emsp;软件方面也十分丰富，官方镜像<kbd>myir-image-full</kbd>包含常用系统和调试工具，支持shell、C、C++、python3，带qt5.15运行所需的所有环境，在官方例程中，提供了QT、LVGL两大图形库的例程，开箱即用，非常便于新手起步学习Linux嵌入式开发</p>
<h2 id="常用指令-自存"><a href="#常用指令-自存" class="headerlink" title="常用指令|自存"></a>常用指令|自存</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">killall app2 #终止原版yocto镜像中开机自启的QT应用，释放接口与内存</span><br><span class="line"></span><br><span class="line">source /opt/remi-sdk/environment-setup-aarch64-poky-linux # 引入环境</span><br><span class="line"></span><br><span class="line">ifup_wifi_sta -ssid Rua -passwd 20030115 # 连接WiFi</span><br><span class="line"></span><br><span class="line">weston-start</span><br><span class="line">gst-play-1.0 video1.mp4 # 播放视频</span><br><span class="line">weston-image bus.jpg # 显示照片</span><br><span class="line"></span><br><span class="line">weston-start</span><br><span class="line">gst-launch-1.0 v4l2src device=/dev/video0 ! video/x-raw,format=YUY2,width=640,height=480 ! waylandsink #录像预览</span><br><span class="line">gst-launch-1.0 v4l2src device=/dev/video0 num-buffers=1 ! jpegenc ! filesink location=snapshot.jpg # 拍照     </span><br><span class="line">ffmpeg -f v4l2 -i /dev/video0 -frames:v 1 /home/root/test_ffmpeg.jpg # 拍照2</span><br><span class="line">tar -xzvf 压缩文件名.tar.gz -C 目标目录 </span><br><span class="line">tar -zcvf test.tar.gz test.txt</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="主机部署SDK"><a href="#主机部署SDK" class="headerlink" title="主机部署SDK"></a>主机部署SDK</h1><p>&emsp;&emsp;依官方要求，推荐使用Ubuntu20.04 64bit(desktop)，双核以上CPU，8GB以上内存，200GB硬盘。</p>
<ol>
<li><b>配置环境</b><br>在主机中安装所需的软件包：<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install gawk wget git-core diffstat unzip texinfo gcc-multilib</span><br><span class="line">sudo apt-get install build-essential chrpath socat cpio python3 python3-pip</span><br><span class="line">sudo apt-get install python3-pexpect xz-utils debianutils iputils-ping</span><br><span class="line">sudo apt-get install python3-git python3-jinja2 libegl1-mesa libsdl1.2-dev</span><br><span class="line">sudo apt-get install pylint3 xterm libssl-dev libyaml-dev</span><br></pre></td></tr></table></figure></li>
<li><b>配置SDK</b><br>在<b><a target="_blank" rel="noopener" href="https://down.myir-tech.com/RemiPi/">官方资料</a></b>中下载SDK，位于<kbd>03-Tools/Toolchains/sdk.tar.bz2</kbd>中，复制到主机中并解压：<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xvf &lt;文件名&gt;</span><br></pre></td></tr></table></figure></li>
</ol>
<ul>
<li>-x 表示提取文件</li>
<li>-v 表示详细模式，显示每个被提取的文件的名称</li>
<li>-f 后接指定存档文件的名称</li>
</ul>
<ol>
<li><b>安装SDK</b><br>在解压目录中，可发现安装脚本：<kbd>poky-glibc-x86_64-myir-image-full-aarch64-myir-remi-1g-toolchain-3.1.20.sh</kbd>，执行即可，它会询问你想要安装在哪里，笔者选择的是：/opt/remi-sdk</li>
<li><b>测试</b><br>首先，安装目录底下有个环境脚本，其中配置了一些变量，如所使用编译器、版本等参数，每次需编译前都需使用<kbd>source</kbd>引入环境变量：<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /opt/remi-sdk/environment-setup-aarch64-poky-linux</span><br></pre></td></tr></table></figure>
而后使用<kbd>echo</kbd>命令即可得到所配置的环境变量，如果先前步骤正确，则输出应为：<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">remi@ubuntu:~$ echo $CC</span><br><span class="line">aarch64-poky-linux-gcc -mtune=cortex-a55 -fstack-protector-strong -D_FORTIFY_SOURCE=2 -Wformat -Wformat-security -Werror=format-security --sysroot=/opt/remi-sdk/sysroots/aarch64-poky-linux</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>&emsp;&emsp;进而，可以直接使用<kbd>$CC -v</kbd>查看编译器版本信息。<br><mark class="hl-label red">注：不要忽略掉$，在bash中这是取变量内容的意思，会直接替换掉原内容，相当于C语言的define</mark>  </p>
<h1 id="部署神经网络模型"><a href="#部署神经网络模型" class="headerlink" title="部署神经网络模型"></a>部署神经网络模型</h1><p>&emsp;&emsp;在本次开发中，被我选择移植至瑞米派的是ncnn，这是因为瑞米派无NPU，只能使用CPU推算神经网络模型，而按照官方的说法：<br>“ncnn 是一个为手机端极致优化的高性能神经网络前向计算框架。 ncnn 从设计之初深刻考虑手机端的部署和使用。 无第三方依赖，跨平台，手机端 cpu 的速度快于目前所有已知的开源框架。”<br>由此得知ncnn框架非常适合在仅使用CPU的平台上使用。经实际测试，在瑞米派上执行：</p>
<blockquote>
<ul>
<li>squeezenet-ssd: 84ms</li>
<li>yolov5s: 2044ms</li>
</ul>
</blockquote>
<p>很慢，但至少能跑起来。 </p>
<ol>
<li><b>克隆工程</b><br>首先，克隆<a target="_blank" rel="noopener" href="https://github.com/Tencent/ncnn">官方仓库</a>到开发环境中，这会在你的工作目录中下载一个名为ncnn的库<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo git clone https://github.com/Tencent/ncnn.git</span><br></pre></td></tr></table></figure></li>
<li><b>编写命令shell</b><br>在<kbd>工程目录/ncnn</kbd>中编写shell指令，<kbd>source</kbd>指令是用于引用开发SDK的环境变量<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi test.sh</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/usr/bin/env bash</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#### remi</span></span></span><br><span class="line">mkdir -p build-for-remi # 新建目录</span><br><span class="line">pushd build-for-remi    # 进入目录</span><br><span class="line">source /opt/remi-sdk/environment-setup-aarch64-poky-linux # 引入环境</span><br><span class="line">cmake .. -DCMAKE_BUILD_TYPE=Release -DNCNN_BUILD_EXAMPLES=ON -DNCNN_SIMPLEOCV=ON # 使用CMakeLists生成Mackfile</span><br><span class="line">make -j4 # 执行Makefile</span><br><span class="line">make install</span><br><span class="line">popd # 回到上一级目录</span><br></pre></td></tr></table></figure></li>
<li><p><b>编译例程</b><br>使用chmod赋予执行权限后执行上述编写的脚本，在build-for-remi/example中可发现编译出来的例程，我们以yolov5为例子，使用<kbd>file \<filename> </kbd>命令可查看此二进制文件的架构，输出如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">remi@ubuntu:~/Desktop/ncnn/build-for-remi/examples$ file yolov5</span><br><span class="line">yolov5: ELF 64-bit LSB shared object, ARM aarch64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-aarch64.so.1, for GNU/Linux 3.14.0, BuildID[sha1]=2d9245aff966b326567859b79cd8d973f879d303, with debug_info, not stripped</span><br></pre></td></tr></table></figure>
<p>易知它是aarch架构的，符合我们的目标开发板</p>
</li>
<li><p><b> 在开发板中执行</b><br>&emsp;&emsp;推荐使用Mobaxterm链接ssh，进行命令行控制的同时，可以上传\下载文件<br>在<a target="_blank" rel="noopener" href="https://github.com/nihui/ncnn-assets/tree/master/models">模型文档</a>中下载<kbd>yolov5s_6.0.bin</kbd>、<kbd>yolov5s_6.0.param</kbd>、先前编译出来的二进制文件并自行找一张图片放在同一个目录下，<br>使用指令执行二进制文件执行神经网络预测：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./yolov5 bus.jpg</span><br></pre></td></tr></table></figure>
<p>可发现目录下生成了image.png,这便是预测的结果</p>
</li>
<li><p><b>使用自己训练的模型</b><br>&emsp;&emsp;首先，需要将yolov5训练得到的pt模型转换为更加通用的onnx模型，再使用<a target="_blank" rel="noopener" href="https://convertmodel.com/#outputFormat=ncnn">在线模型转换</a>，将onnx模型转换为ncnn模型，从而可被ncnn框架解析并推理。<br><img src="image.png" alt="在线模型转换"><br>在<a target="_blank" rel="noopener" href="https://netron.app/">netron</a>中，可查看模型的架构与训练层，还有输入层、输出层的名字。</p>
</li>
<li><p><b>修改源文件</b><br>&emsp;&emsp;在ncnn/example中存放着例程的源码文件，还是以yolov5.cpp为例，全文五百多行，但别慌，需要更改的东西其实很少，主要有三个地方：</p>
</li>
</ol>
<ul>
<li>在detect_yolov5函数中将load_param和load_model替换为自己模型的名字</li>
<li>在其后，修改输入层与三个输出层的名字</li>
<li>在draw_objects函数中，将class_name修改为实际模型的识别类别<br>修改完毕后，重新执行一次shell指令即可，生成执行自己模型的二进制文件</li>
</ul>
<h1 id="训练Yolov5模型"><a href="#训练Yolov5模型" class="headerlink" title="训练Yolov5模型"></a>训练Yolov5模型</h1><p>&emsp;&emsp;为了使作品更加智能化、现代化，我使用YoloV5模型训练模型进行图像识别。</p>
<h2 id="租用云平台"><a href="#租用云平台" class="headerlink" title="租用云平台"></a>租用云平台</h2><p>&emsp;&emsp;在本次竞赛中，我使用的是矩池云，选用已经配置好环境的镜像可以为我们节省很多麻烦<br><img src="image-5.png" alt="alt text"></p>
<h2 id="配置训练环境"><a href="#配置训练环境" class="headerlink" title="配置训练环境"></a>配置训练环境</h2><p>在<a target="_blank" rel="noopener" href="https://github.com/ultralytics/yolov5.git">官方仓库</a>中选择v7版本的yolov5，打包下载粘贴到在线环境中，再进行环境配置：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -r requirements.txt</span><br></pre></td></tr></table></figure></p>
<h2 id="准备数据集"><a href="#准备数据集" class="headerlink" title="准备数据集"></a>准备数据集</h2><p>数据集结构：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">├── score</span><br><span class="line">       ├─ images</span><br><span class="line">       │    ├─ train # 下面放训练集图片</span><br><span class="line">       │    └─ val # 下面放验证集图片</span><br><span class="line">       └─ labels</span><br><span class="line">              ├─ train # 下面放训练集标签</span><br><span class="line">              ├─ val # 下面放验证集标签</span><br></pre></td></tr></table></figure><br>训练集应至少100张，验证集不少于训练集的50％<br>在数据集目录中：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">conda activate Yolov5</span><br><span class="line">pip install labelimg -i https://mirror.baidu.com/pypi/simple</span><br><span class="line">labelimg</span><br></pre></td></tr></table></figure><br>会打开标注图片的软件，完成以下配置：</p>
<ol>
<li>打开图片目录</li>
<li>更改保存目录并设置自动保存</li>
<li>标记、画框,使用<kbd>ctrl+s</kbd>,按<kbd>d</kbd>切换下一张<h2 id="修改参数文件yaml"><a href="#修改参数文件yaml" class="headerlink" title="修改参数文件yaml"></a>修改参数文件yaml</h2>模型参数在：<code>/yolov5-7.0/models/</code><br>数据集参数在：<code>/yolov5-7.0/data/</code><h2 id="训练模型"><a href="#训练模型" class="headerlink" title="训练模型"></a>训练模型</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python train.py --data balloon_data.yaml --cfg balloon_yolov5s.yaml --weights pretrained/yolov5s.pt --epoch 100 --batch-size 16 --device 0</span><br><span class="line">python train.py --data fan_data.yaml --cfg fan_yolov5s.yaml --weights yolov5s.pt --epoch 100 --batch-size 16 --device 0 </span><br></pre></td></tr></table></figure>
等待其执行完成，模型的生成目录会一并在命令行给出，一般在<kbd>runs/train/</kbd>中<h2 id="模型测试"><a href="#模型测试" class="headerlink" title="模型测试"></a>模型测试</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 使用图片测试</span></span></span><br><span class="line">python detect.py --source data/images/balloon.jpg --weights trained/balloon.pt</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 使用摄像头测试</span></span></span><br><span class="line">python detect.py --source 0 --weights train_model/fan.pt</span><br></pre></td></tr></table></figure>
<img src="fan_detect.png" alt="识别结果"><h2 id="模型转换"><a href="#模型转换" class="headerlink" title="模型转换"></a>模型转换</h2>&emsp;&emsp;上文我们训练出来的模型是为Pytorch使用的（后缀为.pt,tenseflow则为.pb）,我们需要将其转换为更通用的onnx模型。</li>
<li>修改<kbd>models/yolo.py</kbd><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Detect</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        self.training = <span class="literal">True</span> <span class="comment">#加入这句可以使得导出来的模型为训练模型，这样就不会加入后处理代码了</span></span><br></pre></td></tr></table></figure></li>
<li><p>修改export.py</p>
</li>
<li><p>导出模型</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python ./export.py --weights ./trained/fan.pt --imgsz 640 --include onnx --simplify --opset 11</span><br></pre></td></tr></table></figure>
<p>由于上述提到的在线模型转换工具用不了，我使用的是<a target="_blank" rel="noopener" href="https://github.com/Tencent/ncnn/releases">官方编译出来的转换工具</a>   </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./onnx2ncnn fan.onnx fan.param fan.bin</span><br></pre></td></tr></table></figure>
<h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2><p>将训练的模型从云端服务器copy回主机测试运行时，发现报错：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">(Yolov5) D:\Python\yolov5-7.0&gt;python detect.py --<span class="built_in">source</span> 0 --weights train_model/best.pt</span><br><span class="line">detect: weights=[<span class="string">&#x27;train_model/best.pt&#x27;</span>], <span class="built_in">source</span>=0, data=data\coco128.yaml, imgsz=[640, 640], conf_thres=0.25, iou_thres=0.45, max_det=1000, device=, view_img=False, save_txt=False, save_conf=False, save_crop=False, nosave=False, classes=None, agnostic_nms=False, augment=False, visualize=False, update=False, project=runs\detect, name=exp, exist_ok=False, line_thickness=3, hide_labels=False, hide_conf=False, half=False, dnn=False, vid_stride=1</span><br><span class="line">YOLOv5  2022-11-22 Python-3.8.17 torch-1.10.0 CUDA:0 (NVIDIA GeForce MX450, 2048MiB)</span><br><span class="line"></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;detect.py&quot;</span>, line 259, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    main(opt)</span><br><span class="line">  File <span class="string">&quot;detect.py&quot;</span>, line 254, <span class="keyword">in</span> main</span><br><span class="line">    run(**vars(opt))</span><br><span class="line">  File <span class="string">&quot;D:\Anaconda3\envs\Yolov5\lib\site-packages\torch\autograd\grad_mode.py&quot;</span>, line 28, <span class="keyword">in</span> decorate_context</span><br><span class="line">    <span class="built_in">return</span> func(*args, **kwargs)</span><br><span class="line">  File <span class="string">&quot;detect.py&quot;</span>, line 96, <span class="keyword">in</span> run</span><br><span class="line">    model = DetectMultiBackend(weights, device=device, dnn=dnn, data=data, fp16=half)</span><br><span class="line">  File <span class="string">&quot;D:\Python\yolov5-7.0\models\common.py&quot;</span>, line 345, <span class="keyword">in</span> __init__</span><br><span class="line">    model = attempt_load(weights <span class="keyword">if</span> isinstance(weights, list) <span class="keyword">else</span> w, device=device, inplace=True, fuse=fuse)</span><br><span class="line">  File <span class="string">&quot;D:\Python\yolov5-7.0\models\experimental.py&quot;</span>, line 79, <span class="keyword">in</span> attempt_load</span><br><span class="line">    ckpt = torch.load(attempt_download(w), map_location=<span class="string">&#x27;cpu&#x27;</span>)  <span class="comment"># load</span></span><br><span class="line">  File <span class="string">&quot;D:\Anaconda3\envs\Yolov5\lib\site-packages\torch\serialization.py&quot;</span>, line 607, <span class="keyword">in</span> load</span><br><span class="line">    <span class="built_in">return</span> _load(opened_zipfile, map_location, pickle_module, **pickle_load_args)</span><br><span class="line">  File <span class="string">&quot;D:\Anaconda3\envs\Yolov5\lib\site-packages\torch\serialization.py&quot;</span>, line 882, <span class="keyword">in</span> _load</span><br><span class="line">    result = unpickler.load()</span><br><span class="line">  File <span class="string">&quot;D:\Anaconda3\envs\Yolov5\lib\pathlib.py&quot;</span>, line 1044, <span class="keyword">in</span> __new__</span><br><span class="line">    raise NotImplementedError(<span class="string">&quot;cannot instantiate %r on your system&quot;</span></span><br><span class="line">NotImplementedError: cannot instantiate <span class="string">&#x27;PosixPath&#x27;</span> on your system</span><br></pre></td></tr></table></figure>
<p>这是因为读取模型错误，在windows中使用了linux的读取函数，我们在models/experimental的<kbd>atteampt_load</kbd>函数中新增以下语句即可：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pathlib</span><br><span class="line">pathlib.PosixPath = pathlib.WindowsPath</span><br></pre></td></tr></table></figure>
<p><img src="image-6.png" alt="alt text"></p>
</li>
</ol>
<p>转换的模型，部署在板端的时偶发梯度爆炸，目前原因未知。（已解决，修改param的reshape的0值为-1）<br><img src="image-7.png" alt="alt text"></p>
<h1 id="OpenCV的使用"><a href="#OpenCV的使用" class="headerlink" title="OpenCV的使用"></a>OpenCV的使用</h1><h2 id="移植"><a href="#移植" class="headerlink" title="移植"></a>移植</h2><p>opencv作为一个纯C语言编写的库，可以很方便地与我们的工程结合起来,</p>
<ol>
<li>下载opencv源代码<br>作为著名的开源工程，其全部源代码向全社会公开：<b><a target="_blank" rel="noopener" href="https://opencv.org/releases/">源码下载</a></b>,笔者本次下载的是4.8.0版本</li>
<li><p>修改CMakeLists<br>位于opencv-4.8.0/platforms/linux/aarch64-gnu.toolchain.cmake </p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>(CMAKE_SYSTEM_PROCESSOR aarch64)</span><br><span class="line"><span class="keyword">set</span>(GCC_COMPILER_VERSION <span class="string">&quot;&quot;</span> CACHE <span class="keyword">STRING</span> <span class="string">&quot;GCC Compiler version&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(CMAKE_C_COMPILER aarch64-poky-linux-gcc)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_COMPILER aarch64-poky-linux-g++)</span><br><span class="line"></span><br><span class="line"><span class="keyword">Set</span>(CMAKE_C_FLAGS <span class="string">&quot;-mtune=cortex-a55 -fstack-protector-strong -D_FORTIFY_SOURCE=2 -Wformat -Wformat-security -Werror=format-security --sysroot=/opt/remi-sdk/sysroots/aarch64-poky-linux&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_FLAGS <span class="string">&quot;-mtune=cortex-a55 -fstack-protector-strong -D_FORTIFY_SOURCE=2 -Wformat -Wformat-security -Werror=format-security --sysroot=/opt/remi-sdk/sysroots/aarch64-poky-linux&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(GNU_MACHINE <span class="string">&quot;aarch64-pocky-gnu&quot;</span> CACHE <span class="keyword">STRING</span> <span class="string">&quot;GNU compiler triple&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;$&#123;CMAKE_CURRENT_LIST_DIR&#125;/arm.toolchain.cmake&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>其中，参数sysroot是SDK安装的目录  </p>
</li>
<li><p>编译<br>在opencv下新建一个build目录</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">source /opt/remi-sdk/environment-setup-aarch64-poky-linux </span><br><span class="line">cmake .. -DCMAKE_TOOLCHAIN_FILE=/home/remi/Desktop/opencv/opencv-4.8.0/platforms/linux/aarch64-gnu.toolchain.cmake  -DCMAKE_INSTALL_PREFIX=/home/remi/Desktop/opencv/install </span><br><span class="line">make -j4</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;其中，DCMAKE_TOOLCHAIN_FILE指定了所使用的工具链，也就是我们第二步修改的；DCMAKE_INSTALL_PREFIX指定了install的目录，即交叉编译出来的opencv库。<br>&emsp;&emsp;编译完成后，在install/lib下可看见46个动态链接库文件，将其复制到Remi Pi的<code>lib64</code>文件夹下，即可在板端运行opencv。</p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>一个标准的工程结构：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">├── build</span><br><span class="line">│   └── opencv_test_demo</span><br><span class="line">├── CMakeLists.txt</span><br><span class="line">└── main.cpp</span><br></pre></td></tr></table></figure></li>
<li>编写CMakeLists<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.16</span>.<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">project</span>(opencv_test)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(CMAKE_CROSSCOMPILING <span class="keyword">TRUE</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(CMAKE_SYSTEM_NAME Linux)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_SYSTEM_PROCESSOR aarch64)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD <span class="number">11</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#需要配置环境</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_C_COMPILER <span class="string">&quot;aarch64-poky-gcc&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_COMPILER <span class="string">&quot;aarch64-poky-linux-g++&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(CMAKE_C_COMPILER_FORCED <span class="keyword">TRUE</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_COMPILER_FORCED <span class="keyword">TRUE</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(CMAKE_C_FLAGS <span class="string">&quot;-mtune=cortex-a55 -fstack-protector-strong -D_FORTIFY_SOURCE=2 -Wformat -Wformat-security -Werror=format-security --sysroot=/opt/remi-sdk/sysroots/aarch64-poky-linux&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_FLAGS <span class="string">&quot;-mtune=cortex-a55 -fstack-protector-strong -D_FORTIFY_SOURCE=2 -Wformat -Wformat-security -Werror=format-security --sysroot=/opt/remi-sdk/sysroots/aarch64-poky-linux&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#本机实际交叉编译出来的opencv库的路径</span></span><br><span class="line"><span class="keyword">set</span>(OPENCV_PATH /home/remi/Desktop/opencv/build)</span><br><span class="line"></span><br><span class="line"><span class="keyword">include_directories</span>(<span class="variable">$&#123;OPENCV_PATH&#125;</span>/<span class="keyword">include</span>/opencv4)</span><br><span class="line"><span class="keyword">link_directories</span>(<span class="variable">$&#123;OPENCV_PATH&#125;</span>/lib)</span><br><span class="line"><span class="keyword">set</span>(OPENCV_LIBS <span class="variable">$&#123;OPENCV_LIBS&#125;</span> opencv_core opencv_imgcodecs opencv_imgproc)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置 OpenCV_DIR 以找到 OpenCVConfig.cmake</span></span><br><span class="line"><span class="keyword">set</span>(OpenCV_DIR <span class="variable">$&#123;OPENCV_PATH&#125;</span>/lib/cmake/opencv4)</span><br><span class="line"><span class="comment"># 设置 OpenCV 库</span></span><br><span class="line"><span class="keyword">find_package</span>(OpenCV REQUIRED)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_executable</span>(<span class="variable">$&#123;PROJECT_NAME&#125;</span> main.cpp)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(OPENCV_LIBS opencv_core opencv_imgcodecs opencv_imgproc opencv_videoio opencv_highgui)</span><br><span class="line"></span><br><span class="line"><span class="keyword">target_link_libraries</span>(<span class="variable">$&#123;PROJECT_NAME&#125;</span> <span class="variable">$&#123;OPENCV_LIBS&#125;</span>)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li>编写main.c<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/imgproc.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/imgcodecs.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/imgproc/types_c.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cv;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span> </span>&#123;</span><br><span class="line">    Mat image;</span><br><span class="line">    image = <span class="built_in">imread</span>(<span class="string">&quot;./test.jpg&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(!image.data)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;no image data (./demo.jpg)\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;read image succes!\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Mat dst;</span><br><span class="line">    <span class="built_in">cvtColor</span>(image, dst, CV_BGR2GRAY);</span><br><span class="line">    <span class="built_in">imwrite</span>(<span class="string">&quot;grey_image.jpg&quot;</span>, dst);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;img change grey successfully!\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="测试程序2"><a href="#测试程序2" class="headerlink" title="测试程序2"></a>测试程序2</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/imgcodecs.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/highgui.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/imgproc.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/objdetect.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;set&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 打开默认摄像头</span></span><br><span class="line">    <span class="function">cv::VideoCapture <span class="title">cap</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!cap.<span class="built_in">isOpened</span>()) &#123;</span><br><span class="line">        std::cerr &lt;&lt; <span class="string">&quot;无法打开摄像头&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        std::cerr &lt;&lt; <span class="string">&quot;成功打开摄像头&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 读取一帧</span></span><br><span class="line">    cv::Mat frame;</span><br><span class="line">    cap &gt;&gt; frame;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (frame.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">        std::cerr &lt;&lt; <span class="string">&quot;无法读取帧&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 保存帧为图片</span></span><br><span class="line">    <span class="keyword">if</span> (!cv::<span class="built_in">imwrite</span>(<span class="string">&quot;snapshot.jpg&quot;</span>, frame)) &#123;</span><br><span class="line">        std::cerr &lt;&lt; <span class="string">&quot;无法保存图片&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;照片已捕捉并保存为 snapshot.jpg&quot;</span> &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li>编译<br>输入以下指令，即可生成目标文件。      <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir build</span><br><span class="line">cd build</span><br><span class="line">cmake ..</span><br><span class="line">make</span><br></pre></td></tr></table></figure>
<h1 id="HMI人机交互界面"><a href="#HMI人机交互界面" class="headerlink" title="HMI人机交互界面"></a>HMI人机交互界面</h1><h2 id="Qt"><a href="#Qt" class="headerlink" title="Qt"></a>Qt</h2>&emsp;&emsp;Qt 是一个跨平台的 C++ 框架，广泛用于开发图形用户界面（GUI）应用程序和跨平台软件，其提供了丰富的功能库，涵盖了从 GUI 到数据库访问、网络通信、多媒体处理等各个方面。<mark class="hl-label red">笔者使用的是QT5.15.0</mark>  
<h3 id="配置交叉编译环境"><a href="#配置交叉编译环境" class="headerlink" title="配置交叉编译环境"></a>配置交叉编译环境</h3></li>
<li>在<kbd>Edits-&gt; Preferences-&gt; Kits-&gt; Compilers</kbd>中添加交叉编译器路径，包括GCC与G++：<br><img src="image-1.png" alt="添加交叉编译器路径"></li>
<li>更改QT Version：<br><img src="image-2.png" alt=""></li>
<li>添加devices<br><img src="image-3.png" alt=""></li>
<li>添加开发套件Kits<br>“Name”设置为”REMI”<br>“Device” 选择”Generic Linux Device 选项<br>“Sysroot”选择目标设备的系统目录，这里以”/opt/remi-sdk/sysroots/aarch64-poky-linux<br>“Compiler”选择之前配置的名称”REMI-G++”与”REMI-GCC”<br>“Qt version”选择之前配置的名称”Qt5.15.0 (REMI-System)”<br>“Qt mkspec”填写为”linux-oe-g++”<br>其它默认，最后点击”Apply”和”OK”按钮<br><img src="image-4.png" alt=""><h3 id="自己的工程"><a href="#自己的工程" class="headerlink" title="自己的工程"></a>自己的工程</h3></li>
<li>直接在QT Creator中创建工程即可，注意Kits（套件）选择刚刚新建的REMI即可</li>
<li>编写代码</li>
<li>build target<h3 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h3>在/usr中可找到工程文件夹，将编译出来的二进制文件复制到板中，并执行：<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export QT_QPA_PLATFORM=linuxfb</span><br><span class="line">./Test-for-Rem # -platform linuxfb</span><br></pre></td></tr></table></figure>
<h2 id="LVGL"><a href="#LVGL" class="headerlink" title="LVGL"></a>LVGL</h2>&emsp;&emsp;LVGL（Light and Versatile Graphics Library）是一个开源的图形库，专为嵌入式系统设计，适合资源受限的嵌入式环境，且作为一个纯C语言编写的库，它具有高度的可移植性。<h3 id="官方例程"><a href="#官方例程" class="headerlink" title="官方例程"></a>官方例程</h3>官方例程配置地很完善,只需要两步即可将例程跑起来</li>
<li>克隆工程<br>在<a target="_blank" rel="noopener" href="https://down.myir-tech.com/RemiPi/">官方资源</a>下载source文件中的lvgl压缩包放入开发环境中并解压：<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xvf lvgl.tar.bz2 </span><br></pre></td></tr></table></figure></li>
<li><p>编译</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">source /opt/remi-sdk/environment-setup-aarch64-poky-linux</span><br><span class="line">make -j4</span><br></pre></td></tr></table></figure>
<p>在当前目录中即会生成一个名为lvgl_demod的可执行文件  </p>
</li>
<li><p>运行<br>使用ssh、FTP等方式将可执行文件传到开发板,即可执行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod +x lvgl_demo</span><br><span class="line">./lvgl_demo</span><br></pre></td></tr></table></figure>
<p>笔者附：官方的例程似乎参考了韦东山的lvgl例程，在此附上一并作为参考：<b><a target="_blank" rel="noopener" href="https://gitee.com/weidongshan/stm32mp157-lvgl">韦东山 / stm32mp157-lvgl</a></b>,在瑞萨官方论坛中有移植过程：<b><a target="_blank" rel="noopener" href="https://bbs.myir-tech.com/thread-8697-1-1.html">瑞萨移植过程</a></b></p>
<h3 id="工程文档解析"><a href="#工程文档解析" class="headerlink" title="工程文档解析"></a>工程文档解析</h3></li>
<li><b>Makefile</b><br>查看工程目录下的<kbd>Makefile</kbd>:<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">LVGL_DIR_NAME ?= lvgl <span class="comment"># 意为设定默认值</span></span><br><span class="line">LVGL_DIR ?= $&#123;shell pwd&#125; <span class="comment"># 同上，但是查询shell变量</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 编译器标志 (CFLAGS)</span></span><br><span class="line">CFLAGS = -O3 -g0 -I<span class="variable">$(LVGL_DIR)</span>/ -Wall -Wshadow -Wundef -Wmissing-prototypes -Wno-discarded-qualifiers -Wall -Wextra -Wno-unused-function -Wno-error=strict-prototypes -Wpointer-arith -fno-strict-aliasing -Wno-error=cpp -Wuninitialized -Wmaybe-uninitialized -Wno-unused-parameter -Wno-missing-field-initializers -Wtype-limits -Wsizeof-pointer-memaccess -Wno-format-nonliteral -Wno-cast-qual -Wunreachable-code -Wno-switch-default -Wreturn-type -Wmultichar -Wformat-security -Wno-ignored-qualifiers -Wno-error=pedantic -Wno-sign-compare -Wno-error=missing-prototypes -Wdouble-promotion -Wclobbered -Wdeprecated -Wempty-body -Wtype-limits -Wshift-negative-value -Wstack-usage=2048 -Wno-unused-value -Wno-unused-parameter -Wno-missing-field-initializers -Wuninitialized -Wmaybe-uninitialized -Wall -Wextra -Wno-unused-parameter -Wno-missing-field-initializers -Wtype-limits -Wsizeof-pointer-memaccess -Wno-format-nonliteral -Wpointer-arith -Wno-cast-qual -Wmissing-prototypes -Wunreachable-code -Wno-switch-default -Wreturn-type -Wmultichar -Wno-discarded-qualifiers -Wformat-security -Wno-ignored-qualifiers -Wno-sign-compare</span><br><span class="line"><span class="comment"># 链接器标志 (LDFLAGS)</span></span><br><span class="line">LDFLAGS = -lm   -lpthread</span><br><span class="line"><span class="comment"># 本地编译标志 (LOCAL_CFLAGS)</span></span><br><span class="line">LOCAL_CFLAGS = -I/media/disk_p/duxy/nxp/opt_5.15/sysroots/x86_64-pokysdk-linux/usr/<span class="keyword">include</span>/drm</span><br><span class="line"><span class="comment"># 综合编译标志 (CCFLAGS)</span></span><br><span class="line">CCFLAGS  = <span class="variable">$(LOCAL_CFLAGS)</span> <span class="variable">$(INCLUDES)</span> <span class="variable">$(CFLAGS)</span></span><br><span class="line"></span><br><span class="line">BIN = lvgl_demo</span><br><span class="line"></span><br><span class="line"><span class="comment">#Collect the files to compile</span></span><br><span class="line"><span class="comment"># 定义主源文件</span></span><br><span class="line">MAINSRC = ./lvgl_demo.c ./img_myir_logo.c ./img_openeuler_logo.c</span><br><span class="line"></span><br><span class="line"><span class="comment"># 包含其他 Makefile 文件</span></span><br><span class="line"><span class="keyword">include</span> <span class="variable">$(LVGL_DIR)</span>/lvgl/lvgl.mk</span><br><span class="line"><span class="keyword">include</span> <span class="variable">$(LVGL_DIR)</span>/lv_drivers/lv_drivers.mk</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加额外的 C 源文件</span></span><br><span class="line">CSRCS +=<span class="variable">$(LVGL_DIR)</span>/mouse_cursor_icon.c </span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义目标文件扩展名</span></span><br><span class="line">OBJEXT ?= .o</span><br><span class="line"></span><br><span class="line"><span class="comment"># 汇编、C源文件转换为目标文件</span></span><br><span class="line">AOBJS = $(ASRCS:.S=<span class="variable">$(OBJEXT)</span>)</span><br><span class="line">COBJS = $(CSRCS:.c=<span class="variable">$(OBJEXT)</span>)</span><br><span class="line"><span class="comment"># 主源文件转换为目标文件</span></span><br><span class="line">MAINOBJ = $(MAINSRC:.c=<span class="variable">$(OBJEXT)</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 汇总所有源文件和目标文件</span></span><br><span class="line">SRCS = <span class="variable">$(ASRCS)</span> <span class="variable">$(CSRCS)</span> <span class="variable">$(MAINSRC)</span></span><br><span class="line">OBJS = <span class="variable">$(AOBJS)</span> <span class="variable">$(COBJS)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## MAINOBJ -&gt; OBJFILES</span></span><br><span class="line"><span class="section">all: default</span></span><br><span class="line"></span><br><span class="line"><span class="section">%.o: %.c</span></span><br><span class="line">	@<span class="variable">$(CC)</span>  <span class="variable">$(CCFLAGS)</span> -c <span class="variable">$&lt;</span> -o <span class="variable">$@</span> <span class="comment"># 第一个@意为抑制指令回显，第二个指目标值，-c代表编译出.o文件，&lt;指的是第一个依赖变量</span></span><br><span class="line">	@echo <span class="string">&quot;<span class="variable">$(CC)</span> <span class="variable">$&lt;</span>&quot;</span></span><br><span class="line">    </span><br><span class="line"><span class="section">default: <span class="variable">$(AOBJS)</span> <span class="variable">$(COBJS)</span> <span class="variable">$(MAINOBJ)</span></span></span><br><span class="line">	<span class="variable">$(CC)</span> -o <span class="variable">$(BIN)</span> <span class="variable">$(MAINOBJ)</span> <span class="variable">$(AOBJS)</span> <span class="variable">$(COBJS)</span> <span class="variable">$(LDFLAGS)</span></span><br><span class="line"></span><br><span class="line"><span class="section">clean: </span></span><br><span class="line">	rm -f <span class="variable">$(BIN)</span> <span class="variable">$(AOBJS)</span> <span class="variable">$(COBJS)</span> <span class="variable">$(MAINOBJ)</span></span><br></pre></td></tr></table></figure>
CFLGES中定义参数的含义为：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">-O3: 启用优化级别 3。</span><br><span class="line">-g0: 不生成调试信息。</span><br><span class="line">-I$(LVGL_DIR)/: 添加包含路径，指向 LVGL_DIR。</span><br><span class="line">-Wall: 启用所有常见的警告。</span><br><span class="line">-Wshadow: 警告变量遮蔽问题。</span><br><span class="line">-Wundef: 警告未定义的宏。</span><br><span class="line">-Wmissing-prototypes: 警告缺少原型声明的函数。</span><br><span class="line">-Wno-discarded-qualifiers: 禁用丢弃限定符的警告。</span><br><span class="line">-Wextra: 启用额外的警告。</span><br><span class="line">-Wno-unused-function: 禁用未使用函数的警告。</span><br><span class="line">-Wno-error=strict-prototypes: 禁用严格原型的错误。</span><br><span class="line">-Wpointer-arith: 警告指针算术问题。</span><br><span class="line">-fno-strict-aliasing: 禁用严格别名优化。</span><br><span class="line">-Wno-error=cpp: 禁用预处理器警告变为错误。</span><br><span class="line">-Wuninitialized: 警告未初始化的变量。</span><br><span class="line">-Wmaybe-uninitialized: 警告可能未初始化的变量。</span><br><span class="line">-Wno-unused-parameter: 禁用未使用参数的警告。</span><br><span class="line">-Wno-missing-field-initializers: 禁用缺少字段初始化的警告。</span><br><span class="line">-Wtype-limits: 警告类型限制问题。</span><br><span class="line">-Wsizeof-pointer-memaccess: 警告指针大小访问问题。</span><br><span class="line">-Wno-format-nonliteral: 禁用非字面格式警告。</span><br><span class="line">-Wno-cast-qual: 禁用类型转换限定符警告。</span><br><span class="line">-Wunreachable-code: 警告不可达代码。</span><br><span class="line">-Wno-switch-default: 禁用 switch 语句缺少 default 分支的警告。</span><br><span class="line">-Wreturn-type: 警告返回类型问题。</span><br><span class="line">-Wmultichar: 警告多字符常量。</span><br><span class="line">-Wformat-security: 警告格式字符串安全问题。</span><br><span class="line">-Wno-ignored-qualifiers: 禁用忽略限定符的警告。</span><br><span class="line">-Wno-error=pedantic: 禁用严格标准的错误。</span><br><span class="line">-Wno-sign-compare: 禁用符号比较的警告。</span><br><span class="line">-Wdouble-promotion: 警告浮点数提升问题。</span><br><span class="line">-Wclobbered: 警告变量被覆盖的问题。</span><br><span class="line">-Wdeprecated: 警告弃用的功能。</span><br><span class="line">-Wempty-body: 警告空的代码块。</span><br><span class="line">-Wshift-negative-value: 警告负值移位。</span><br><span class="line">-Wstack-usage=2048: 警告栈使用超过 2048 字节。</span><br></pre></td></tr></table></figure>
关于LDFLAGS：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-lm 表示链接数学库（libm），这是标准的 C 数学库，包含数学函数，如 sin、cos、sqrt 等。</span><br><span class="line">-lpthread 表示链接 POSIX 线程库（libpthread），用于多线程编程。</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="修改工程"><a href="#修改工程" class="headerlink" title="修改工程"></a>修改工程</h3><p>&emsp;&emsp;根据对Makefile文件的分析，如果只是为了快速开发，我们可以直接修改工程文档中的lvgl_demo.c,从而实现自己想要的效果，例如：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">char</span>* github_addr = <span class="string">&quot;Jungang&quot;</span>;</span><br><span class="line"><span class="type">lv_obj_t</span> * label = <span class="built_in">lv_label_create</span>(<span class="built_in">lv_scr_act</span>());</span><br><span class="line"><span class="built_in">lv_label_set_recolor</span>(label, <span class="literal">true</span>);</span><br><span class="line"><span class="built_in">lv_label_set_long_mode</span>(label, LV_LABEL_LONG_SCROLL_CIRCULAR); <span class="comment">/*Circular scroll*/</span></span><br><span class="line"><span class="built_in">lv_obj_set_width</span>(label, <span class="number">240</span>);</span><br><span class="line"><span class="built_in">lv_label_set_text_fmt</span>(label, <span class="string">&quot;#ff0000 Name:# #0000ff %s#&quot;</span>, github_addr);</span><br><span class="line"><span class="built_in">lv_obj_align</span>(label, LV_ALIGN_CENTER, <span class="number">0</span>, <span class="number">10</span>);</span><br><span class="line">	</span><br><span class="line"><span class="type">lv_obj_t</span> * label2 = <span class="built_in">lv_label_create</span>(<span class="built_in">lv_scr_act</span>());</span><br><span class="line"><span class="built_in">lv_label_set_recolor</span>(label2, <span class="literal">true</span>);</span><br><span class="line"><span class="built_in">lv_label_set_long_mode</span>(label2, LV_LABEL_LONG_SCROLL_CIRCULAR); <span class="comment">/*Circular scroll*/</span></span><br><span class="line"><span class="built_in">lv_obj_set_width</span>(label2, <span class="number">120</span>);</span><br><span class="line"><span class="built_in">lv_label_set_text_fmt</span>(label2, <span class="string">&quot;#ff0000 Hello# #0000ff world !# #ff0000 Hello# #0000ff world !#&quot;</span>);</span><br><span class="line"><span class="built_in">lv_obj_align</span>(label2, LV_ALIGN_CENTER, <span class="number">0</span>, <span class="number">-10</span>);</span><br></pre></td></tr></table></figure><br>运行效果为两行红蓝色文字居中显示，其中一行滚动。</p>
<h3 id="鼠标的配置"><a href="#鼠标的配置" class="headerlink" title="鼠标的配置"></a>鼠标的配置</h3><p>在lv_drv_conf.h中修改EVDEV_NAME为鼠标的event，如：<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#  define EVDEV_NAME   &quot;/dev/input/event1&quot;  </span><br></pre></td></tr></table></figure><br>在linux中，使用evtest工具可以定位鼠标使用的event号</p>
<h3 id="文件系统的移植"><a href="#文件系统的移植" class="headerlink" title="文件系统的移植"></a>文件系统的移植</h3><p>&emsp;&emsp;LVGL其实已经完成了这部分的适配，在<a target="_blank" rel="noopener" href="https://lvgl.100ask.net/8.2/libs/fsdrv.html">百问网-文件系统移植</a>中可以看出，移植只需要更改一个地方：在<code>lvgl_conf.h</code>中，修改<code>LV_USE_FS_POSIX</code>的值为1，并指定一个盘符。<br><img src="image-2.png" alt="所要修改的地方"><br>使用则是：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">lv_obj_t</span> * wp;</span><br><span class="line">wp = <span class="built_in">lv_img_create</span>(ui_Screen2);</span><br><span class="line"><span class="built_in">lv_img_set_src</span>(wp, <span class="string">&quot;L:/home/root/test/image.png&quot;</span>);</span><br><span class="line"><span class="built_in">lv_obj_align</span>(wp, LV_ALIGN_CENTER, <span class="number">0</span>, <span class="number">300</span>); </span><br></pre></td></tr></table></figure></p>
<h3 id="引入中文字库"><a href="#引入中文字库" class="headerlink" title="引入中文字库"></a>引入中文字库</h3><p>&emsp;&emsp;本方法适合在字数少的时候使用，如果需要包含大量字库，建议使用<code>freetype库</code>，否则程序容易卡死。</p>
<ol>
<li>字库转换<br>使用<a target="_blank" rel="noopener" href="https://lvgl.io/tools/fontconverter">官方转换网站</a>，转出所需的字库文件,在<code>lv_conf.h</code>中使能：<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> LV_FONT_FMT_TXT_LARGE 1</span></span><br></pre></td></tr></table></figure></li>
<li>声明字库文件<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LV_FONT_DECLARE(Keshe)</span><br></pre></td></tr></table></figure></li>
<li>使用、<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lv_obj_set_style_text_font(name_label, &amp;Keshe, LV_STATE_DEFAULT);</span><br></pre></td></tr></table></figure>
<h3 id="使用Freetype字库"><a href="#使用Freetype字库" class="headerlink" title="使用Freetype字库"></a>使用Freetype字库</h3></li>
<li>下载<br>在<a target="_blank" rel="noopener" href="https://download.savannah.gnu.org/releases/freetype/">官网release</a>中下载freetype库</li>
<li>编译<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">source /opt/remi-sdk/environment-setup-aarch64-poky-linux</span><br><span class="line">./configure --host=arm-linux --prefix=$PWD/library --with-zlib=no --with-png=no</span><br><span class="line">make -j4</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
而后在工程目录下的<code>library</code>中有编译出来的库   </li>
<li>移植<br>&emsp;&emsp;官方已经为我们写好了在<a target="_blank" rel="noopener" href="https://github.com/lvgl/lv_lib_freetype">lvgl官方freetype库</a>：<code>lv_freetype.c</code>、<code>lv_freetype.h</code>，在Remi Pi（或者说韦东山）也在<code>工程文档/lvgl/src/extra/libs/freetype</code>为我们准备好了，在其中除了上述提到的两个文件，还有一个测试字体文件。    <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> LV_USE_FREETYPE 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LV_USE_USER_DATA 1</span></span><br></pre></td></tr></table></figure>
&emsp;&emsp;坑的地方来了，先前不知道官方配置了接口文档，自行移植后导致各种宏冲突，改来改去直接把工程结构改乱了，救不回来只能重新移植（幸好有写文档的习惯，重新移植并实现现有功能并没花费太多时间），而不移植接口直接在<code>lv_conf.h</code>中使能上述两个选项会报错，原因在于官方只给了接口文档，<mark class="hl-label red">并没有移植freetype库</mark>  ，这曾困扰了我很久，怎么会连官方例程都编译不通过呢？其实想来也正常，在linux，特别是嵌入式linux领域中，架构各不统一，这种需要编译的库不可能全部提前做好，想明白后思路就通畅了，解决办法如下：<blockquote>
<ul>
<li>将编译出来的library/include/freetype2的<code>freetype</code>文件夹和<code>ft2build.h</code>移入<code>/lvgl/src/extra/libs/freetype</code>       </li>
</ul>
</blockquote>
</li>
</ol>
<p><img src="QQ_1721727710353.png" alt="应该有的文件"></p>
<blockquote>
<ul>
<li>修改makefile文件，使得工程能够正确包含移植的库</li>
</ul>
<p>在<code>/lvgl/src/extra/libs/freetype</code>中，新建<code>lv_lib_freetype.mk</code><br><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lv_lib_freetype.mk </span></span><br><span class="line">LV_LIB_FREETYPE_DIR_NAME ?= freetype</span><br><span class="line"> </span><br><span class="line"><span class="comment">#添加依赖文件路径</span></span><br><span class="line">DEPPATH += --dep-path <span class="variable">$(LVGL_DIR)</span>/lvgl/src/extra/libs/freetype</span><br><span class="line"> </span><br><span class="line"><span class="comment">#添加搜索路径</span></span><br><span class="line">VPATH += :<span class="variable">$(LVGL_DIR)</span>/lvgl/src/extra/libs/freetype</span><br><span class="line"> </span><br><span class="line"><span class="comment">#添加头文件包含路径</span></span><br><span class="line">CFLAGS += <span class="string">&quot;-I<span class="variable">$(LVGL_DIR)</span>/lvgl/src/extra/libs/freetype&quot;</span></span><br><span class="line">CFLAGS += <span class="string">&quot;-I<span class="variable">$(LVGL_DIR)</span>/lvgl/src/extra/libs/freetype/freetype&quot;</span></span><br></pre></td></tr></table></figure><br>在上层extra.mk文件中包含，实现嵌套<br><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span> <span class="variable">$(LVGL_DIR)</span>/lvgl/src/extra/libs/freetype/lv_lib_freetype.mk</span><br><span class="line">CSRCS += <span class="variable">$(<span class="built_in">shell</span> find -L <span class="variable">$(LVGL_DIR)</span>/<span class="variable">$(LVGL_DIR_NAME)</span>/src/extra -name \*.c)</span></span><br></pre></td></tr></table></figure><br>在总的Makefile中增加：<br><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CFLAGS += -L./library</span><br><span class="line">LDFLAGS += -lfreetype</span><br></pre></td></tr></table></figure></p>
</blockquote>
<ol>
<li>测试<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">lv_ft_info_t</span> info;</span><br><span class="line"><span class="comment">/*FreeType uses C standard file system, so no driver letter is required.*/</span></span><br><span class="line">info.name = <span class="string">&quot;./kesong.ttf&quot;</span>;</span><br><span class="line">info.weight = <span class="number">50</span>;</span><br><span class="line">info.style = FT_FONT_STYLE_NORMAL;</span><br><span class="line">info.mem = <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">if</span> (!lv_ft_font_init(&amp;info))</span><br><span class="line">&#123;</span><br><span class="line">    LV_LOG_ERROR(<span class="string">&quot;create failed.&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*Create style with the new font*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">lv_style_t</span> style;</span><br><span class="line">lv_style_init(&amp;style);</span><br><span class="line">lv_style_set_text_font(&amp;style, info.font);</span><br><span class="line">lv_style_set_text_align(&amp;style, LV_TEXT_ALIGN_CENTER);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*Create a label with the new style*/</span></span><br><span class="line"><span class="type">lv_obj_t</span> *label = lv_label_create(ui_Screen1);</span><br><span class="line">lv_obj_add_style(label, &amp;style, <span class="number">0</span>);</span><br><span class="line">lv_label_set_text(label, <span class="string">&quot;Hello world\n 你好世界\nI&#x27;m a font created with FreeType&quot;</span>);</span><br><span class="line">lv_obj_center(label);</span><br></pre></td></tr></table></figure>
<h3 id="注册输入设备与绑定组"><a href="#注册输入设备与绑定组" class="headerlink" title="注册输入设备与绑定组"></a>注册输入设备与绑定组</h3>&emsp;&emsp;</li>
</ol>
<h3 id="启动分析"><a href="#启动分析" class="headerlink" title="启动分析"></a>启动分析</h3><p>&emsp;&emsp;在主函数中，首先通过ioctl子系统获取可变屏幕的分辨率，并设定为LVGL的显示参数。</p>
<h3 id="文档结构"><a href="#文档结构" class="headerlink" title="文档结构"></a>文档结构</h3><p>&emsp;&emsp;在原来的例子中，我们直接使用Makefile来进行项目的编译，在工程根目录中包含各个子模块的.mk文件，从而让编译器包含所有的.c文件，在每个.c文件中包含各自的.h文件，实现在预处理过程中替换文本，完成函数的声明与变量的外部声明。<br>&emsp;&emsp;但使用自带的编译结构有个问题，编译出来的文件都在工程目录中，很乱，可以考虑优化Makefie或使用CMakeLists</p>
<h3 id="注意-1"><a href="#注意-1" class="headerlink" title="注意"></a>注意</h3><p>在使用SquareLine Studio时，其生成的代码中有一段非常离谱的错误，会导致屏幕删除不完全，在<code>ui_helpers.c</code>中：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> _ui_screen_delete(<span class="type">lv_obj_t</span> ** target)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(*target == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        lv_obj_del(*target);</span><br><span class="line">        target = <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>应更改为：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> _ui_screen_delete(<span class="type">lv_obj_t</span> ** target)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(*target != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        lv_obj_del(*target);</span><br><span class="line">        *target = <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Figma"><a href="#Figma" class="headerlink" title="Figma"></a>Figma</h2><p>最受欢迎的Ui设计软件（截至2023），拥有以下特点：</p>
<ol>
<li>团队协作</li>
<li>丰富的开源社区</li>
<li>流畅的操作体验<h1 id="CNN模型训练"><a href="#CNN模型训练" class="headerlink" title="CNN模型训练"></a>CNN模型训练</h1>&emsp;&emsp;在本次项目的使用中，需要识别眼电信号，传统通过判断斜率来判断对应的信号类型，误报率高，精确度低，决定使用CNN（卷积神经网络）进行模型的训练和推理，经测试达到了良好的效果。在电脑端，需要执行训练、推理的过程，使用Tensflow库，但板端只需要执行推理，所以只需要TenseLite库。<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><h2 id="固定设备号"><a href="#固定设备号" class="headerlink" title="固定设备号"></a>固定设备号</h2>&emsp;&emsp;在进行嵌入式Linux程序的开发中，使用外置设备，如USB转TTL、USB摄像头、鼠标等，我们常常在程序中以设备号的形式进行指定和调用，然而，他们的上电顺序直接决定Linux系统分配给他们的设备号，为了程序的稳定和确定性，我们应该为使用到的设备直接指定设备号，而非由Linux自动分配。<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@myir-remi-1g:~/test# lsusb</span><br><span class="line">Bus 001 Device 003: ID 2188:0ae1</span><br><span class="line">Bus 001 Device 002: ID 1a86:8091 QinHeng Electronics USB HUB</span><br><span class="line">Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub</span><br><span class="line">Bus 003 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub</span><br><span class="line">Bus 002 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub</span><br><span class="line">```  </span><br><span class="line">```shell</span><br><span class="line">vi /etc/udev/rules.d/99-usb-serial.rules</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SUBSYSTEM==&quot;tty&quot;, ATTRS&#123;idVendor&#125;==&quot;1a86&quot;, ATTRS&#123;idProduct&#125;==&quot;8091&quot;, SYMLINK+=&quot;my_usb_serial&quot;</span><br></pre></td></tr></table></figure>
<h2 id="摄像头"><a href="#摄像头" class="headerlink" title="摄像头"></a>摄像头</h2>&emsp;&emsp;使用V4L2控制linux上的摄像设备：<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">v4l2-ctl -d /dev/video0 --list-ctrls</span><br><span class="line">v4l2-ctl -d /dev/video0 --set-ctrl=white_balance_automatic=0</span><br><span class="line">v4l2-ctl -d /dev/video0 --set-ctrl=white_balance_temperature=4000</span><br></pre></td></tr></table></figure>
&emsp;&emsp;<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用 ffmpeg 拍照</span></span><br><span class="line">ffmpeg -f v4l2 -i /dev/video0 -frames:v 1 /home/root/test_ffmpeg.jpg</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="综合开发"><a href="#综合开发" class="headerlink" title="综合开发"></a>综合开发</h1><p>&emsp;&emsp;上文分别介绍了AI、Ui、OPENCV的移植，现在让我们来研究如何将他们结合为一个工程。</p>
<h2 id="C与C"><a href="#C与C" class="headerlink" title="C与C++"></a>C与C++</h2><p>&emsp;&emsp;在本次工程中，用到了套接字socket库，这是C++的一个库，但C++支持函数重载和名称修饰，C语言不能直接调用C++的函数，我们需要进行一定的修改：</p>
<ol>
<li>使用extern “C”修饰函数<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> _SERVER_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _SERVER_H</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function"><span class="type">void</span> <span class="title">socket_init</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure></li>
<li>修改Makefile<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#function.mk</span></span><br><span class="line">CPPSRCS += <span class="variable">$(<span class="built_in">shell</span> find -L <span class="variable">$(LVGL_DIR)</span>/function -name &quot;*.cpp&quot;)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Makefile</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#CC ?= aarch64-poky-linux-gcc</span></span><br><span class="line">LVGL_DIR_NAME ?= lvgl</span><br><span class="line">LVGL_DIR ?= $&#123;shell pwd&#125;</span><br><span class="line">CFLAGS = -O3 -g0 -I<span class="variable">$(LVGL_DIR)</span>/ -Wall -Wshadow -Wundef -Wmissing-prototypes -Wno-discarded-qualifiers -Wall -Wextra -Wno-unused-function -Wno-error=strict-prototypes -Wpointer-arith -fno-strict-aliasing -Wno-error=cpp -Wuninitialized -Wmaybe-uninitialized -Wno-unused-parameter -Wno-missing-field-initializers -Wtype-limits -Wsizeof-pointer-memaccess -Wno-format-nonliteral -Wno-cast-qual -Wunreachable-code -Wno-switch-default -Wreturn-type -Wmultichar -Wformat-security -Wno-ignored-qualifiers -Wno-error=pedantic -Wno-sign-compare -Wno-error=missing-prototypes -Wdouble-promotion -Wclobbered -Wdeprecated -Wempty-body -Wtype-limits -Wshift-negative-value -Wstack-usage=2048 -Wno-unused-value -Wno-unused-parameter -Wno-missing-field-initializers -Wuninitialized -Wmaybe-uninitialized -Wall -Wextra -Wno-unused-parameter -Wno-missing-field-initializers -Wtype-limits -Wsizeof-pointer-memaccess -Wno-format-nonliteral -Wpointer-arith -Wno-cast-qual -Wmissing-prototypes -Wunreachable-code -Wno-switch-default -Wreturn-type -Wmultichar -Wno-discarded-qualifiers -Wformat-security -Wno-ignored-qualifiers -Wno-sign-compare</span><br><span class="line"><span class="comment">#LDFLAGS = -lm     -L./SOEM-1.3.3/build/ -lsoem -lpthread -ldrm -L/media/disk_p/duxy/hisi/drm/usr/lib64</span></span><br><span class="line">LDFLAGS = -lm   -lpthread</span><br><span class="line"></span><br><span class="line"><span class="comment">#LOCAL_CFLAGS = -I/media/disk_p/duxy/hisi/drm/usr/include -I/media/disk_p/duxy/hisi/drm/usr/include/libdrm</span></span><br><span class="line">LOCAL_CFLAGS = -I/media/disk_p/duxy/nxp/opt_5.15/sysroots/x86_64-pokysdk-linux/usr/<span class="keyword">include</span>/drm</span><br><span class="line"><span class="comment">#LOCAL_CFLAGS = -I/media/xmr/ST-workplace/sysroots/cortexa7t2hf-neon-vfpv4-ostl-linux-gnueabi/usr/include/drm/</span></span><br><span class="line"></span><br><span class="line">CCFLAGS  = <span class="variable">$(LOCAL_CFLAGS)</span> <span class="variable">$(INCLUDES)</span> <span class="variable">$(CFLAGS)</span></span><br><span class="line"><span class="comment"># C++ 编译选项</span></span><br><span class="line">CXXFLAGS = <span class="variable">$(CFLAGS)</span> -std=c++11</span><br><span class="line"></span><br><span class="line">BIN = lvgl_demo</span><br><span class="line"></span><br><span class="line"><span class="comment">#Collect the files to compile</span></span><br><span class="line">MAINSRC = ./lvgl_demo.c ./img_myir_logo.c ./img_openeuler_logo.c</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="variable">$(LVGL_DIR)</span>/lvgl/lvgl.mk</span><br><span class="line"><span class="keyword">include</span> <span class="variable">$(LVGL_DIR)</span>/lv_drivers/lv_drivers.mk</span><br><span class="line"><span class="keyword">include</span> <span class="variable">$(LVGL_DIR)</span>/ui/ui.mk</span><br><span class="line"><span class="keyword">include</span> <span class="variable">$(LVGL_DIR)</span>/function/function.mk</span><br><span class="line"> </span><br><span class="line">CFLAGS += -L./library</span><br><span class="line">LDFLAGS += -lfreetype</span><br><span class="line"></span><br><span class="line">CSRCS +=<span class="variable">$(LVGL_DIR)</span>/mouse_cursor_icon.c </span><br><span class="line"><span class="comment"># CPPSRCS +=</span></span><br><span class="line"></span><br><span class="line">OBJEXT ?= .o</span><br><span class="line"></span><br><span class="line">AOBJS = $(ASRCS:.S=<span class="variable">$(OBJEXT)</span>)</span><br><span class="line">COBJS = $(CSRCS:.c=<span class="variable">$(OBJEXT)</span>)</span><br><span class="line">CPPOBJS = $(CPPSRCS:.cpp=<span class="variable">$(OBJEXT)</span>)</span><br><span class="line"></span><br><span class="line">MAINOBJ = $(MAINSRC:.c=<span class="variable">$(OBJEXT)</span>)</span><br><span class="line"></span><br><span class="line">SRCS = <span class="variable">$(ASRCS)</span> <span class="variable">$(CSRCS)</span> <span class="variable">$(CPPSRCS)</span> <span class="variable">$(MAINSRC)</span></span><br><span class="line">OBJS = <span class="variable">$(AOBJS)</span> <span class="variable">$(COBJS)</span> <span class="variable">$(CPPOBJS)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## MAINOBJ -&gt; OBJFILES</span></span><br><span class="line"></span><br><span class="line"><span class="section">all: default</span></span><br><span class="line"></span><br><span class="line"><span class="section">%.o: %.c</span></span><br><span class="line">	@<span class="variable">$(CC)</span>  <span class="variable">$(CCFLAGS)</span> -c <span class="variable">$&lt;</span> -o <span class="variable">$@</span></span><br><span class="line">	@echo <span class="string">&quot;<span class="variable">$(CC)</span> <span class="variable">$&lt;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 新增：如何编译C++源文件</span></span><br><span class="line"><span class="section">%.o: %.cpp</span></span><br><span class="line">	<span class="comment"># @$(CXX) -c $&lt; -o $@</span></span><br><span class="line">	<span class="comment"># @$(CXX) $(CXXFLAGS) -c $&lt; -o $@</span></span><br><span class="line">	@<span class="variable">$(CXX)</span> <span class="variable">$(CCFLAGS)</span> -c <span class="variable">$&lt;</span> -o <span class="variable">$@</span></span><br><span class="line">    </span><br><span class="line"><span class="section">default: <span class="variable">$(AOBJS)</span> <span class="variable">$(COBJS)</span> <span class="variable">$(CPPOBJS)</span> <span class="variable">$(MAINOBJ)</span> </span></span><br><span class="line">	<span class="variable">$(CXX)</span> -o <span class="variable">$(BIN)</span> <span class="variable">$(MAINOBJ)</span> <span class="variable">$(AOBJS)</span> <span class="variable">$(COBJS)</span> <span class="variable">$(CPPOBJS)</span> <span class="variable">$(LDFLAGS)</span></span><br><span class="line"></span><br><span class="line"><span class="section">clean: </span></span><br><span class="line">	rm -f <span class="variable">$(BIN)</span> <span class="variable">$(AOBJS)</span> <span class="variable">$(COBJS)</span> <span class="variable">$(MAINOBJ)</span></span><br><span class="line"></span><br><span class="line"><span class="section">debug:</span></span><br><span class="line">	@echo <span class="variable">$(CPPSRCS)</span></span><br><span class="line">	@echo <span class="variable">$(CPPOBJS)</span></span><br></pre></td></tr></table></figure>
<h2 id="多线程开发"><a href="#多线程开发" class="headerlink" title="多线程开发"></a>多线程开发</h2>&emsp;&emsp;Remi-Pi的CPU是双核的，为了最大化利用资源，在进行IO操作，如进行网络校时，使用网络API、调用模型识别等，这都需要耗费大量的时间并阻塞当前进程。笔者主要使用pthread库以及互斥锁实现。</li>
</ol>
<h2 id="调用系统shell"><a href="#调用系统shell" class="headerlink" title="调用系统shell"></a>调用系统shell</h2><p>&emsp;&emsp;本次工程中，用到的语言繁多，包括C、C++、python，无法编译为一个可执行程序，这就需要借用系统shell来执行对应的功能。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://dikle-ovo.github.io">黄俊刚</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://dikle-ovo.github.io/2024/05/20/Remi-Pi/">https://dikle-ovo.github.io/2024/05/20/Remi-Pi/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://dikle-ovo.github.io" target="_blank">DIKLE | 记录</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E8%AE%B0%E5%BD%95/">记录</a><a class="post-meta__tags" href="/tags/Linux/">Linux</a></div><div class="post_share"><div class="social-share" data-image="/my_img/cat.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/05/24/tspi/" title="记录|泰山嵌入式Linux开发"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">记录|泰山嵌入式Linux开发</div></div></a></div><div class="next-post pull-right"><a href="/2024/05/17/Embedded-Linux/" title="记录|嵌入式Linux开发"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">记录|嵌入式Linux开发</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2024/05/24/tspi/" title="记录|泰山嵌入式Linux开发"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-24</div><div class="title">记录|泰山嵌入式Linux开发</div></div></a></div><div><a href="/2025/02/20/Graduation-Design/" title="记录|智能视觉人体追随"><img class="cover" src="/2025/02/20/Graduation-Design/cover.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-02-20</div><div class="title">记录|智能视觉人体追随</div></div></a></div><div><a href="/2024/05/16/visual_module/" title="记录|一些使用过的图形处理"><img class="cover" src="/2024/05/16/visual_module/cover.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-16</div><div class="title">记录|一些使用过的图形处理</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/my_img/cat.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">黄俊刚</div><div class="author-info__description">这是一个个人博客嗷</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">24</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">13</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Dikle-OvO"><i class="fab fa-github"></i><span>Github主页</span></a></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4-%E8%87%AA%E5%AD%98"><span class="toc-number">1.1.</span> <span class="toc-text">常用指令|自存</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%BB%E6%9C%BA%E9%83%A8%E7%BD%B2SDK"><span class="toc-number">2.</span> <span class="toc-text">主机部署SDK</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B"><span class="toc-number">3.</span> <span class="toc-text">部署神经网络模型</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AE%AD%E7%BB%83Yolov5%E6%A8%A1%E5%9E%8B"><span class="toc-number">4.</span> <span class="toc-text">训练Yolov5模型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A7%9F%E7%94%A8%E4%BA%91%E5%B9%B3%E5%8F%B0"><span class="toc-number">4.1.</span> <span class="toc-text">租用云平台</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E8%AE%AD%E7%BB%83%E7%8E%AF%E5%A2%83"><span class="toc-number">4.2.</span> <span class="toc-text">配置训练环境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E6%95%B0%E6%8D%AE%E9%9B%86"><span class="toc-number">4.3.</span> <span class="toc-text">准备数据集</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%8F%82%E6%95%B0%E6%96%87%E4%BB%B6yaml"><span class="toc-number">4.4.</span> <span class="toc-text">修改参数文件yaml</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B"><span class="toc-number">4.5.</span> <span class="toc-text">训练模型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E5%9E%8B%E6%B5%8B%E8%AF%95"><span class="toc-number">4.6.</span> <span class="toc-text">模型测试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E5%9E%8B%E8%BD%AC%E6%8D%A2"><span class="toc-number">4.7.</span> <span class="toc-text">模型转换</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F"><span class="toc-number">4.8.</span> <span class="toc-text">注意</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#OpenCV%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">5.</span> <span class="toc-text">OpenCV的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A7%BB%E6%A4%8D"><span class="toc-number">5.1.</span> <span class="toc-text">移植</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-number">5.2.</span> <span class="toc-text">使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E7%A8%8B%E5%BA%8F2"><span class="toc-number">5.3.</span> <span class="toc-text">测试程序2</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#HMI%E4%BA%BA%E6%9C%BA%E4%BA%A4%E4%BA%92%E7%95%8C%E9%9D%A2"><span class="toc-number">6.</span> <span class="toc-text">HMI人机交互界面</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Qt"><span class="toc-number">6.1.</span> <span class="toc-text">Qt</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91%E7%8E%AF%E5%A2%83"><span class="toc-number">6.1.1.</span> <span class="toc-text">配置交叉编译环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%B7%B1%E7%9A%84%E5%B7%A5%E7%A8%8B"><span class="toc-number">6.1.2.</span> <span class="toc-text">自己的工程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C"><span class="toc-number">6.1.3.</span> <span class="toc-text">运行</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LVGL"><span class="toc-number">6.2.</span> <span class="toc-text">LVGL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%98%E6%96%B9%E4%BE%8B%E7%A8%8B"><span class="toc-number">6.2.1.</span> <span class="toc-text">官方例程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E7%A8%8B%E6%96%87%E6%A1%A3%E8%A7%A3%E6%9E%90"><span class="toc-number">6.2.2.</span> <span class="toc-text">工程文档解析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%B7%A5%E7%A8%8B"><span class="toc-number">6.2.3.</span> <span class="toc-text">修改工程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%BC%A0%E6%A0%87%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="toc-number">6.2.4.</span> <span class="toc-text">鼠标的配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%9A%84%E7%A7%BB%E6%A4%8D"><span class="toc-number">6.2.5.</span> <span class="toc-text">文件系统的移植</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%95%E5%85%A5%E4%B8%AD%E6%96%87%E5%AD%97%E5%BA%93"><span class="toc-number">6.2.6.</span> <span class="toc-text">引入中文字库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Freetype%E5%AD%97%E5%BA%93"><span class="toc-number">6.2.7.</span> <span class="toc-text">使用Freetype字库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C%E8%BE%93%E5%85%A5%E8%AE%BE%E5%A4%87%E4%B8%8E%E7%BB%91%E5%AE%9A%E7%BB%84"><span class="toc-number">6.2.8.</span> <span class="toc-text">注册输入设备与绑定组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E5%88%86%E6%9E%90"><span class="toc-number">6.2.9.</span> <span class="toc-text">启动分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E6%A1%A3%E7%BB%93%E6%9E%84"><span class="toc-number">6.2.10.</span> <span class="toc-text">文档结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F-1"><span class="toc-number">6.2.11.</span> <span class="toc-text">注意</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Figma"><span class="toc-number">6.3.</span> <span class="toc-text">Figma</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#CNN%E6%A8%A1%E5%9E%8B%E8%AE%AD%E7%BB%83"><span class="toc-number">7.</span> <span class="toc-text">CNN模型训练</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%B6%E4%BB%96"><span class="toc-number">8.</span> <span class="toc-text">其他</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%BA%E5%AE%9A%E8%AE%BE%E5%A4%87%E5%8F%B7"><span class="toc-number">8.1.</span> <span class="toc-text">固定设备号</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%91%84%E5%83%8F%E5%A4%B4"><span class="toc-number">8.2.</span> <span class="toc-text">摄像头</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%BC%E5%90%88%E5%BC%80%E5%8F%91"><span class="toc-number">9.</span> <span class="toc-text">综合开发</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#C%E4%B8%8EC"><span class="toc-number">9.1.</span> <span class="toc-text">C与C++</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%BC%80%E5%8F%91"><span class="toc-number">9.2.</span> <span class="toc-text">多线程开发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B0%83%E7%94%A8%E7%B3%BB%E7%BB%9Fshell"><span class="toc-number">9.3.</span> <span class="toc-text">调用系统shell</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/06/McuOTA/" title="McuOTA">McuOTA</a><time datetime="2026-01-06T09:07:04.000Z" title="发表于 2026-01-06 17:07:04">2026-01-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/02/20/Graduation-Design/" title="记录|智能视觉人体追随"><img src="/2025/02/20/Graduation-Design/cover.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="记录|智能视觉人体追随"/></a><div class="content"><a class="title" href="/2025/02/20/Graduation-Design/" title="记录|智能视觉人体追随">记录|智能视觉人体追随</a><time datetime="2025-02-20T04:40:36.000Z" title="发表于 2025-02-20 12:40:36">2025-02-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/11/16/Sky-photo/" title="Sky|影像"><img src="/2024/11/16/Sky-photo/coverx.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Sky|影像"/></a><div class="content"><a class="title" href="/2024/11/16/Sky-photo/" title="Sky|影像">Sky|影像</a><time datetime="2024-11-16T11:36:58.000Z" title="发表于 2024-11-16 19:36:58">2024-11-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/11/11/Process-Control/" title="过程控制系统"><img src="/2024/11/11/Process-Control/cover.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="过程控制系统"/></a><div class="content"><a class="title" href="/2024/11/11/Process-Control/" title="过程控制系统">过程控制系统</a><time datetime="2024-11-11T05:17:32.000Z" title="发表于 2024-11-11 13:17:32">2024-11-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/11/04/Canmv/" title="韦东山Canmv|AIOT开发"><img src="/2024/11/04/Canmv/cover.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="韦东山Canmv|AIOT开发"/></a><div class="content"><a class="title" href="/2024/11/04/Canmv/" title="韦东山Canmv|AIOT开发">韦东山Canmv|AIOT开发</a><time datetime="2024-11-04T09:19:17.000Z" title="发表于 2024-11-04 17:19:17">2024-11-04</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2026 By 黄俊刚</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">I wish you to become your own sun, no need to rely on who's light.</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (true){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"><script>(() => {
  const $mermaidWrap = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaidWrap.length) {
    window.runMermaid = () => {
      window.loadMermaid = true
      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

      Array.from($mermaidWrap).forEach((item, index) => {
        const mermaidSrc = item.firstElementChild
        const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
        const mermaidID = 'mermaid-' + index
        const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent
        mermaid.mermaidAPI.render(mermaidID, mermaidDefinition, (svgCode) => {
          mermaidSrc.insertAdjacentHTML('afterend', svgCode)
        })
      })
    }

    const loadMermaid = () => {
      window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
    }

    window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
  }
})()</script></div><script async src="/js/title.js"></script><canvas class="fireworks" mobile="true"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script></div></body></html>